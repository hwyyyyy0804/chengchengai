<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¯šè¯šçš„æ™ºèƒ½aiæ•™å®¤</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      font-family: "Microsoft YaHei", sans-serif;
      background-image: url('https://t.tutu.to/img/udXme');
      background-size: cover;
      background-position: center;
      position: relative;
    }

    .chengcheng {
      position: absolute;
      bottom: 0px;
      left: 50px;
      width: 750px;
      height: 750px;
      object-fit: contain;
      z-index: 10;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .chengcheng:hover {
      transform: scale(1.02);
    }

    #position_demo {
      position: absolute;
      right: 10px;
      bottom: 20px;
    }

    /* ---------- å¼•å¯¼æ°”æ³¡ï¼šå‘ä¸‹ç®­å¤´ï¼Œä½äºæ‚¬æµ®çƒæ­£ä¸Šæ–¹ ---------- */
    .coze-guide {
      position: fixed;
      right: 20px;
      bottom: 130px;        /* å®Œå…¨ä¸é®æŒ¡æ‚¬æµ®çƒ */
      z-index: 9999;
      pointer-events: none; /* ç‚¹å‡»ç©¿é€ï¼Œç›´æ¥ç‚¹ä¸­ä¸‹æ–¹æ‚¬æµ®çƒ */
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    .guide-bubble {
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(4px);
      color: white;
      padding: 12px 24px;
      border-radius: 40px;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.3);
      white-space: nowrap;
      animation: gentle-bounce 2s infinite ease-in-out;
      position: relative;
    }

    /* å‘ä¸‹ç®­å¤´ */
    .guide-bubble::after {
      content: '';
      position: absolute;
      bottom: -12px;
      right: 30px;
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 12px solid rgba(0, 0, 0, 0.85);
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }

    @keyframes gentle-bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    /* å¼ºåˆ¶éšè—å¼•å¯¼æ°”æ³¡ï¼ˆ!important ç¡®ä¿æœ€é«˜ä¼˜å…ˆçº§ï¼‰ */
    .coze-guide.hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- è¯šè¯šå¤´åƒï¼ˆå¤‡ç”¨å…¥å£ï¼‰ -->
  <img src="https://t.tutu.to/img/udELR" alt="è¯šè¯š" class="chengcheng" id="chengcheng-avatar" />

  <div id="position_demo"></div>

  <!-- å¼•å¯¼æ°”æ³¡ -->
  <div class="coze-guide" id="cozeGuide">
    <div class="guide-bubble">
      âœ¨ ç‚¹æˆ‘å’Œè¯šè¯šèŠå¤©
    </div>
  </div>

  <!-- Coze SDK -->
  <script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.20/libs/cn/index.js"></script>
  <script>
    (function() {
      let cozeInstance = null;
      const guide = document.getElementById('cozeGuide');

      // ----- éšè—æ°”æ³¡ï¼ˆç»Ÿä¸€æ–¹æ³•ï¼‰-----
      function hideGuide() {
        if (guide && !guide.classList.contains('hidden')) {
          guide.classList.add('hidden');
          console.log('âœ… å¼•å¯¼æ°”æ³¡å·²éšè— (hideGuide)');
        }
      }

      // ----- è¯šè¯šå¤´åƒç‚¹å‡»å¤„ç† -----
      function onChengClick() {
        if (cozeInstance) cozeInstance.open();
        console.log('ğŸ’¬ ç‚¹å‡»è¯šè¯šï¼Œæ‰“å¼€å¯¹è¯æ¡†');
        hideGuide();
      }

      // ========== åˆå§‹åŒ– Coze SDK ==========
      const cozeWebSDK = new CozeWebSDK.WebChatClient({
        config: {
          type: 'bot',
          bot_id: '7604541826409857074',
          isIframe: false,
        },
        auth: {
          type: 'token',
          token: 'pat_fPrd68MeDV4AseIVziRHkG2doulT74yxvVG1xH0fL6j0ziF0AIiGS88bYEJXFDLI',
          onRefreshToken: async () => 'token'
        },
        userInfo: {
          id: 'user123',
          url: 'https://q8.itc.cn/q_70/images03/20241118/77f502fb1a36447eab2741c914b00e54.jpeg',
          nickname: 'é™å°å®',
        },
        ui: {
          base: {
            icon: 'https://wimg.588ku.com/gif620/24/02/17/593be1d3d067e84a70916e6b315f26a2.gif',
            layout: 'pc',
            lang: 'zh-CN',
            zIndex: 1000
          },
          header: { isShow: true, isNeedClose: true },
          asstBtn: { isNeed: true }, // âœ… æ‚¬æµ®çƒï¼ˆæ ¸å¿ƒå…¥å£ï¼‰
          footer: {
            isShow: true,
            expressionText: 'Powered by {{name}} {{name1}}',
            linkvars: {
              name: { text: 'A', link: 'https://www.test1.com' },
              name1: { text: 'B', link: 'https://www.test2.com' }
            }
          },
          conversations: { isNeed: false },
          chatBot: {
            title: 'è¯šä¿¡å°åŠ©æ‰‹è¯šè¯š',
            uploadable: true,
            width: 800,
            isNeedAudio: true,
            isNeedFunctionCallMessage: true,
            isNeedAddNewConversation: true,
            isNeedQuote: true,
            feedback: {
              isNeedFeedback: true,
              feedbackPanel: {
                title: 'æ‚¨å¯¹è¿™ä¸ªå›ç­”æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿè¯·å‘Šè¯‰æˆ‘ä»¬',
                placeholder: 'è¯·è¯¦ç»†æè¿°æ‚¨çš„é—®é¢˜...',
                tags: [
                  { label: 'å†…å®¹ä¸å¤Ÿè¯¦ç»†', isNeedDetail: false },
                  { label: 'å†…å®¹é”™è¯¯', isNeedDetail: false },
                  { label: 'å…¶ä»–', isNeedDetail: true },
                ],
              },
            },
          },
        },
        onReady: () => {
          console.log('âœ… Coze SDK å·²å°±ç»ª');
          cozeInstance = cozeWebSDK;

          // ----- ç»‘å®šè¯šè¯šå¤´åƒï¼ˆç¡®ä¿åªç»‘å®šä¸€æ¬¡ï¼‰-----
          const cheng = document.getElementById('chengcheng-avatar');
          if (cheng) {
            cheng.removeEventListener('click', onChengClick);
            cheng.addEventListener('click', onChengClick);
          }

          // ----- å°è¯•ç»‘å®šæ‚¬æµ®çƒç‚¹å‡»ï¼ˆç”¨MutationObserverç¡®ä¿ç»‘å®šï¼‰-----
          const observer = new MutationObserver(() => {
            const launcher = document.querySelector('.coze-web-sdk-launcher');
            if (launcher) {
              // è°ƒæ•´å°ºå¯¸ï¼ˆåŸæœ‰éœ€æ±‚ï¼‰
              launcher.style.width = '80px';
              launcher.style.height = '80px';
              const icon = launcher.querySelector('img, svg');
              if (icon) {
                icon.style.width = '100%';
                icon.style.height = '100%';
                icon.style.objectFit = 'contain';
              }

              // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆé˜²æ­¢é‡å¤ï¼‰
              launcher.removeEventListener('click', hideGuide);
              launcher.addEventListener('click', hideGuide);
              console.log('ğŸ¤– æ‚¬æµ®çƒç‚¹å‡»ç»‘å®šæˆåŠŸ (MutationObserver)');
              observer.disconnect();
            }
          });
          observer.observe(document.body, { childList: true, subtree: true });
        }
      });

      // ---------- ğŸš€ ç»ˆæä¿é™©ï¼šå…¨å±€äº‹ä»¶å§”æ‰˜ï¼ˆæ•è·é˜¶æ®µï¼‰----------
      // æ— è®ºæ‚¬æµ®çƒä½•æ—¶å‡ºç°ã€æ˜¯å¦ç»‘å®šæˆåŠŸï¼Œç‚¹å‡»æ‚¬æµ®çƒå¿…éšè—æ°”æ³¡
      document.body.addEventListener('click', function(e) {
        // æ£€æŸ¥ç‚¹å‡»å…ƒç´ æ˜¯å¦å±äºæ‚¬æµ®çƒï¼ˆå¤šç§ç‰¹å¾ï¼‰
        const target = e.target;
        const isLauncher = target.closest('.coze-web-sdk-launcher') || 
                          target.closest('[class*="coze-web-sdk"]') || // æ¨¡ç³ŠåŒ¹é…
                          (target.tagName === 'IMG' && target.alt === 'è¯šè¯š') || // æ’é™¤è¯šè¯šå¤´åƒ
                          (target.closest('button') && target.closest('button')?.innerHTML.includes('icon')); // é¢å¤–ç‰¹å¾
        
        // æ˜ç¡®æ’é™¤è¯šè¯šå¤´åƒï¼ˆå®ƒæœ‰è‡ªå·±çš„å¤„ç†ï¼Œä½†ä¹Ÿä¼šè§¦å‘éšè—ï¼‰
        const isCheng = target.closest('#chengcheng-avatar');
        
        if (isLauncher || isCheng) {
          hideGuide();
          console.log('ğŸ›¡ï¸ å…¨å±€æ•è·ç‚¹å‡»ï¼Œå¼•å¯¼æ°”æ³¡å·²éšè—', isLauncher ? 'æ¥è‡ªæ‚¬æµ®çƒ' : 'æ¥è‡ªè¯šè¯š');
        }
      }, true); // æ•è·é˜¶æ®µç¡®ä¿ä¼˜å…ˆæ‰§è¡Œ

      // ---------- ğŸ” åŒé‡è½®è¯¢ï¼šæ¯500msæ£€æŸ¥ä¸€æ¬¡ï¼Œè‹¥æ‚¬æµ®çƒå­˜åœ¨ä½†æœªç»‘å®šå°ºå¯¸ï¼Œåˆ™å¼ºåˆ¶ç»‘å®š-----
      // é˜²æ­¢MutationObserveråœ¨æŸäº›æç«¯æƒ…å†µä¸‹æœªè§¦å‘
      let pollCount = 0;
      const pollTimer = setInterval(() => {
        const launcher = document.querySelector('.coze-web-sdk-launcher');
        if (launcher) {
          // ç¡®ä¿å°ºå¯¸å·²è°ƒæ•´
          if (launcher.style.width !== '80px') {
            launcher.style.width = '80px';
            launcher.style.height = '80px';
            const icon = launcher.querySelector('img, svg');
            if (icon) {
              icon.style.width = '100%';
              icon.style.height = '100%';
              icon.style.objectFit = 'contain';
            }
            console.log('ğŸ”„ è½®è¯¢ï¼šæ‚¬æµ®çƒå°ºå¯¸å·²è°ƒæ•´');
          }
          // ç¡®ä¿ç‚¹å‡»äº‹ä»¶å·²ç»‘å®šï¼ˆé€šè¿‡æ£€æŸ¥æ˜¯å¦æœ‰æˆ‘ä»¬æ·»åŠ çš„è‡ªå®šä¹‰å±æ€§ï¼Œæˆ–è€…ç›´æ¥ç»‘å®šï¼‰
          if (!launcher.dataset.guideBound) {
            launcher.addEventListener('click', hideGuide);
            launcher.dataset.guideBound = 'true';
            console.log('ğŸ”„ è½®è¯¢ï¼šæ‚¬æµ®çƒç‚¹å‡»äº‹ä»¶å·²ç»‘å®š');
          }
        }
        pollCount++;
        if (pollCount > 40) clearInterval(pollTimer); // 20ç§’ååœæ­¢
      }, 500);
    })();
  </script>
</body>
</html>
